<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Список Организаций</title>
</head>
<body>
<h2>Доступные организации</h2>
<div id="org-list">
    <p>Загрузка...</p>
</div>

<script>
    window.addEventListener('load', async () => {
        const listDiv = document.getElementById('org-list');
        const token = localStorage.getItem('authToken');

        try {
            // Используем наш НОВЫЙ эндпоинт в OrganizationController
            const response = await fetch('/api/organization/all', {
                headers: {'Authorization': `Bearer ${token}`}
            });

            if (!response.ok) {
                listDiv.textContent = 'Ошибка загрузки списка.';
                return;
            }

            const organizations = await response.json();
            listDiv.innerHTML = ''; // Очищаем "Загрузка..."

            if (organizations.length === 0) {
                listDiv.textContent = 'Организаций пока нет.';
                return;
            }

            organizations.forEach(org => {
                const orgElement = document.createElement('div');
                orgElement.style.border = '1px solid black';
                orgElement.style.padding = '10px';
                orgElement.style.marginBottom = '5px';

                orgElement.innerHTML = `
                        <h3>${org.name}</h3>
                        <p>Адрес: ${org.address || 'Не указан'}</p>
                        <button class="join-btn" data-org-id="${org.id}">Вступить</button>
                    `;
                listDiv.appendChild(orgElement);
            });

        } catch (error) {
            listDiv.textContent = `Сетевая ошибка: ${error}`;
        }
    });

    // "Вступить" (пока просто выводит ID)
    document.getElementById('org-list').addEventListener('click', function(e) {
        if (e.target.classList.contains('join-btn')) {
            const orgId = e.target.getAttribute('data-org-id');
            alert(`Тут будет логика вступления в организацию ID: ${orgId}`);
            // Здесь бы ты вызвал `fetch('/api/organization/join', ...)`
        }
    });
</script>
</body>
</html>